(()=>{"use strict";var e="https://mesto.nomoreparties.co/v1/wff-cohort-38",t="1f8e2a8a-f6e1-4325-8bc4-fc2c4878ac28";function n(n,o,r){(function(n){return fetch("".concat(e,"/cards/").concat(n),{method:"DELETE",headers:{authorization:t}})})(o).then((function(e){if(!e.ok)return Promise.reject("Ошибка при удалении карточки");r.remove()})).catch((function(e){return console.error(e)}))}function o(n,o,r){var c=n.target,i=c.classList.contains("card__like-button_is-active")?function(n){return fetch("".concat(e,"/cards/likes/").concat(n),{method:"DELETE",headers:{authorization:t}}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}(o):function(n){return fetch("".concat(e,"/cards/likes/").concat(n),{method:"PUT",headers:{authorization:t}}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}(o);i.then((function(e){c.classList.toggle("card__like-button_is-active"),r.textContent=e.likes.length}))}function r(e,t,n,o,r){var c=e.name,i=e.link,a=e.likes,u=e.ownerId,s=e.cardId,l=document.querySelector("#card-template").content.cloneNode(!0).querySelector(".card"),p=l.querySelector(".card__image"),d=l.querySelector(".card__delete-button"),_=l.querySelector(".card__like-button"),f=l.querySelector(".likes-count");return p.src=i,p.alt=c,l.querySelector(".card__title").textContent=c,f.textContent=a.length,a.some((function(e){return e._id===t}))&&_.classList.add("card__like-button_is-active"),u!==t?d.remove():d.addEventListener("click",(function(e){return n(e,s,l)})),p.addEventListener("click",(function(){return r({name:c,link:i})})),_.addEventListener("click",(function(e){return o(e,s,f)})),l}var c=null;function i(e,t){t.textContent=e?"Сохранение...":"Сохранить"}function a(e){(c=e).classList.add("popup_is-opened"),window.addEventListener("keydown",s),c.addEventListener("click",l)}function u(){c&&(c.classList.remove("popup_is-opened"),window.removeEventListener("keydown",s),c.removeEventListener("click",l),c=null)}function s(e){"Escape"===e.key&&u()}function l(e){(e.target.classList.contains("popup__close")||!e.target.closest(".popup__content")||e.target.classList.contains("popup__button"))&&u()}var p,d=function(e,t,n,o){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.add(o.inputErrorClass),r.textContent=n,r.classList.add(o.errorClass)},_=function(e,t,n){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n.inputErrorClass),o.textContent="",o.classList.remove(n.errorClass)},f=function(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.classList.remove(n.inactiveButtonClass),t.disabled=!1):(t.classList.add(n.inactiveButtonClass),t.disabled=!0)},m=function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);n.forEach((function(n){_(e,n,t)})),f(n,o,t)},y={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};p=y,Array.from(document.querySelectorAll(p.formSelector)).forEach((function(e){e.addEventListener("submit",(function(e){e.preventDefault()})),function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);f(n,o,t),n.forEach((function(r){r.addEventListener("input",(function(){!function(e,t,n){if(t.validity.valid)_(e,t,n);else if(t.validity.valueMissing)d(e,t,"Это поле обязательно для заполнения",n);else if(t.validity.patternMismatch){var o=t.dataset.errorMessage||"Неверный формат";d(e,t,o,n)}else t.validity.tooShort?d(e,t,"Минимум ".concat(t.minLength," символа"),n):t.validity.tooLong?d(e,t,"Максимум ".concat(t.maxLength," символов"),n):t.validity.typeMismatch&&"url"===t.type?d(e,t,"Введите корректный URL",n):d(e,t,t.validationMessage,n)}(e,r,t),f(n,o,t)}))}))}(e,p)}));var v={name:document.querySelector(".profile__title"),description:document.querySelector(".profile__description"),avatar:document.querySelector(".profile__image"),id:null},h=document.querySelector(".places__list"),S=document.querySelector(".profile__image"),k=document.querySelector(".profile__edit-button"),q=document.querySelector(".profile__add-button"),L=document.querySelectorAll(".popup"),b=document.querySelector(".popup_type_edit-avatar"),g=b.querySelector(".popup__form"),E=g.querySelector(".popup__input_type_avatar"),C=document.querySelector(".popup_type_edit"),j=C.querySelector(".popup__form"),w=j.querySelector(".popup__input_type_name"),x=j.querySelector(".popup__input_type_description"),P=document.querySelector(".popup_type_new-card"),A=P.querySelector(".popup__form"),T=A.querySelector(".popup__input_type_card-name"),z=A.querySelector(".popup__input_type_url"),I=document.querySelector(".popup_type_image");function B(e){var t=e.name,n=e.link,o=I.querySelector(".popup__image"),r=I.querySelector(".popup__caption");o.src=n,o.alt=t,r.textContent=t,a(I)}fetch("".concat(e,"/users/me"),{headers:{authorization:t}}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){v.name.textContent=e.name,v.description.textContent=e.about,v.avatar.style.backgroundImage="url(".concat(e.avatar,")"),v.id=e._id})).catch((function(e){console.log(e)})),fetch("".concat(e,"/cards"),{headers:{authorization:t}}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){e.forEach((function(e){var t=r({name:e.name,link:e.link,likes:e.likes,ownerId:e.owner._id,cardId:e._id},v.id,n,o,B);h.append(t)}))})).catch((function(e){console.log(e)})),S.addEventListener("click",(function(){m(g,y),a(b)})),g.addEventListener("submit",(function(n){n.preventDefault();var o=E.value,r=document.querySelector(".popup_type_edit-avatar .popup__button");i(!0,r),function(n){return fetch("".concat(e,"/users/me/avatar"),{method:"PATCH",headers:{authorization:t,"Content-Type":"application/json"},body:JSON.stringify({avatar:n})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}(o).then((function(e){v.avatar.style.backgroundImage="url(".concat(e.avatar,")"),g.reset()})).catch((function(e){console.log(e)})).finally((function(){i(!1,r)}))})),k.addEventListener("click",(function(){w.value=document.querySelector(".profile__title").textContent,x.value=document.querySelector(".profile__description").textContent,m(j,y),a(C)})),j.addEventListener("submit",(function(n){n.preventDefault();var o,r,c=document.querySelector(".popup_type_edit .popup__button");i(!0,c),(o=w.value,r=x.value,fetch("".concat(e,"/users/me"),{method:"PATCH",headers:{authorization:t,"Content-Type":"application/json"},body:JSON.stringify({name:o,about:r})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(e){v.name.textContent=e.name,v.description.textContent=e.about})).catch((function(e){console.log(e)})).finally((function(){i(!1,c)}))})),q.addEventListener("click",(function(){A.reset(),m(A,y),a(P)})),A.addEventListener("submit",(function(c){c.preventDefault();var a=T.value,u=z.value,s=document.querySelector(".popup_type_new-card .popup__button");i(!0,s),function(n,o){return fetch("".concat(e,"/cards"),{method:"POST",headers:{authorization:t,"Content-Type":"application/json"},body:JSON.stringify({name:n,link:o})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}(a,u).then((function(e){var t=r({name:e.name,link:e.link,likes:e.likes,ownerId:e.owner._id,cardId:e._id},v.id,n,o,B);h.prepend(t),A.reset()})).catch((function(e){console.log(e)})).finally((function(){i(!1,s)}))})),L.forEach((function(e){e.classList.add("popup_is-animated")}))})();